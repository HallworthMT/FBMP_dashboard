
var trendSummary = [{"species":"MOWA","trend":-0.2024,"LCItrend":-0.2884,"UCItrend":-0.1221,"Mediantrend":-0.1973,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"YBFL","trend":-0.1956,"LCItrend":-0.2938,"UCItrend":-0.1062,"Mediantrend":-0.1935,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"SWSP","trend":-0.1922,"LCItrend":-0.2422,"UCItrend":-0.1456,"Mediantrend":-0.1881,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"YEWA","trend":-0.1628,"LCItrend":-0.1959,"UCItrend":-0.1273,"Mediantrend":-0.1667,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"GRCA","trend":-0.151,"LCItrend":-0.197,"UCItrend":-0.1021,"Mediantrend":-0.1516,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"PUFI","trend":-0.1507,"LCItrend":-0.177,"UCItrend":-0.1244,"Mediantrend":-0.1514,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"RBWO","trend":-0.1478,"LCItrend":-0.1928,"UCItrend":-0.1012,"Mediantrend":-0.149,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"SOSP","trend":-0.1436,"LCItrend":-0.1804,"UCItrend":-0.0988,"Mediantrend":-0.142,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"CSWA","trend":-0.1323,"LCItrend":-0.1701,"UCItrend":-0.0862,"Mediantrend":-0.1376,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"GCKI","trend":-0.1311,"LCItrend":-0.1559,"UCItrend":-0.1077,"Mediantrend":-0.131,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"YTVI","trend":-0.1222,"LCItrend":-0.1594,"UCItrend":-0.0685,"Mediantrend":-0.1285,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"BAOR","trend":-0.12,"LCItrend":-0.1558,"UCItrend":-0.087,"Mediantrend":-0.1207,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"NAWA","trend":-0.1193,"LCItrend":-0.1603,"UCItrend":-0.0821,"Mediantrend":-0.1157,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"BHCO","trend":-0.1119,"LCItrend":-0.1386,"UCItrend":-0.0842,"Mediantrend":-0.1104,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"RWBL","trend":-0.1113,"LCItrend":-0.1508,"UCItrend":-0.0627,"Mediantrend":-0.1224,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"NOWA","trend":-0.0966,"LCItrend":-0.1626,"UCItrend":-0.0437,"Mediantrend":-0.1064,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"SWTH","trend":-0.0929,"LCItrend":-0.132,"UCItrend":-0.061,"Mediantrend":-0.0893,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"YSFL","trend":-0.0813,"LCItrend":-0.1286,"UCItrend":-0.0327,"Mediantrend":-0.074,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"MAWA","trend":-0.0797,"LCItrend":-0.1401,"UCItrend":-0.0463,"Mediantrend":-0.0614,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"NOPA","trend":-0.0746,"LCItrend":-0.1152,"UCItrend":-0.0263,"Mediantrend":-0.0856,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"AMGO","trend":-0.068,"LCItrend":-0.1038,"UCItrend":-0.0281,"Mediantrend":-0.0678,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"CHIP","trend":-0.0641,"LCItrend":-0.1081,"UCItrend":-0.0024,"Mediantrend":-0.0779,"StatSig":true,"propInSupport":0.9867,"Years":"1989-2023"},{"species":"LEFL","trend":-0.0603,"LCItrend":-0.0954,"UCItrend":-0.0359,"Mediantrend":-0.0592,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"CAWA","trend":-0.06,"LCItrend":-0.1016,"UCItrend":-0.0276,"Mediantrend":-0.0602,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"TUTI","trend":-0.0587,"LCItrend":-0.0887,"UCItrend":-0.0309,"Mediantrend":-0.0609,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"COYE","trend":-0.052,"LCItrend":-0.0888,"UCItrend":-0.0295,"Mediantrend":-0.0485,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"RESQ","trend":-0.0471,"LCItrend":-0.0754,"UCItrend":-0.0142,"Mediantrend":-0.0458,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"RBNU","trend":-0.0404,"LCItrend":-0.0647,"UCItrend":-0.0153,"Mediantrend":-0.0384,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"CEDW","trend":-0.0263,"LCItrend":-0.0727,"UCItrend":0.0163,"Mediantrend":-0.0131,"StatSig":false,"propInSupport":0.7133,"Years":"1989-2023"},{"species":"AMRE","trend":-0.0241,"LCItrend":-0.043,"UCItrend":-0.0067,"Mediantrend":-0.0214,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"BLBW","trend":-0.0236,"LCItrend":-0.064,"UCItrend":0.006,"Mediantrend":-0.015,"StatSig":false,"propInSupport":0.9167,"Years":"1989-2023"},{"species":"GCFL","trend":-0.0211,"LCItrend":-0.0419,"UCItrend":-0.0019,"Mediantrend":-0.0208,"StatSig":true,"propInSupport":0.9967,"Years":"1989-2023"},{"species":"WTSP","trend":-0.019,"LCItrend":-0.0394,"UCItrend":0.0111,"Mediantrend":-0.0216,"StatSig":false,"propInSupport":0.87,"Years":"1989-2023"},{"species":"MODO","trend":-0.0075,"LCItrend":-0.0554,"UCItrend":0.0239,"Mediantrend":0.0052,"StatSig":false,"propInSupport":0.3667,"Years":"1989-2023"},{"species":"MYWA","trend":-0.0072,"LCItrend":-0.0327,"UCItrend":0.0214,"Mediantrend":-0.011,"StatSig":false,"propInSupport":0.56,"Years":"1989-2023"},{"species":"BRCR","trend":-0.0027,"LCItrend":-0.0594,"UCItrend":0.0379,"Mediantrend":0.012,"StatSig":false,"propInSupport":0.3533,"Years":"1989-2023"},{"species":"BAWW","trend":-0.0005,"LCItrend":-0.0221,"UCItrend":0.0239,"Mediantrend":-0.003,"StatSig":false,"propInSupport":0.5767,"Years":"1989-2023"},{"species":"BHVI","trend":-0.0001,"LCItrend":-0.0234,"UCItrend":0.024,"Mediantrend":-0.0016,"StatSig":false,"propInSupport":0.5233,"Years":"1989-2023"},{"species":"DOWO","trend":0.0009,"LCItrend":-0.0347,"UCItrend":0.0475,"Mediantrend":-0.0081,"StatSig":false,"propInSupport":0.34,"Years":"1989-2023"},{"species":"PIWO","trend":0.0012,"LCItrend":-0.0127,"UCItrend":0.018,"Mediantrend":0.001,"StatSig":false,"propInSupport":0.5567,"Years":"1989-2023"},{"species":"WOTH","trend":0.0108,"LCItrend":-0.016,"UCItrend":0.0306,"Mediantrend":0.0156,"StatSig":false,"propInSupport":0.7733,"Years":"1989-2023"},{"species":"HAWO","trend":0.0151,"LCItrend":-0.0094,"UCItrend":0.0403,"Mediantrend":0.0127,"StatSig":false,"propInSupport":0.8133,"Years":"1989-2023"},{"species":"WIWR","trend":0.0161,"LCItrend":0.002,"UCItrend":0.0344,"Mediantrend":0.0156,"StatSig":true,"propInSupport":0.9833,"Years":"1989-2023"},{"species":"EAWP","trend":0.0303,"LCItrend":0.0085,"UCItrend":0.0688,"Mediantrend":0.0215,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"VEER","trend":0.0311,"LCItrend":0.0245,"UCItrend":0.04,"Mediantrend":0.0306,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"RBGR","trend":0.0347,"LCItrend":0.017,"UCItrend":0.0559,"Mediantrend":0.0348,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"WBNU","trend":0.04,"LCItrend":0.022,"UCItrend":0.0572,"Mediantrend":0.0402,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"BTNW","trend":0.0414,"LCItrend":0.0101,"UCItrend":0.0732,"Mediantrend":0.0425,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"SCTA","trend":0.0415,"LCItrend":0.0219,"UCItrend":0.0615,"Mediantrend":0.0386,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"YBSA","trend":0.0438,"LCItrend":0.0228,"UCItrend":0.0628,"Mediantrend":0.0422,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"AMRO","trend":0.0448,"LCItrend":0.0224,"UCItrend":0.0585,"Mediantrend":0.0504,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"BLJA","trend":0.0455,"LCItrend":0.0373,"UCItrend":0.0527,"Mediantrend":0.0449,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"REVI","trend":0.0585,"LCItrend":0.0364,"UCItrend":0.0852,"Mediantrend":0.0585,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"BCCH","trend":0.0601,"LCItrend":0.0455,"UCItrend":0.0772,"Mediantrend":0.0578,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"BTBW","trend":0.0614,"LCItrend":0.04,"UCItrend":0.095,"Mediantrend":0.0487,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"OVEN","trend":0.0689,"LCItrend":0.0219,"UCItrend":0.1033,"Mediantrend":0.0862,"StatSig":true,"propInSupport":1,"Years":"1989-2023"},{"species":"HETH","trend":0.0812,"LCItrend":0.0702,"UCItrend":0.0934,"Mediantrend":0.0786,"StatSig":true,"propInSupport":1,"Years":"1989-2023"}] 

console.log(trendSummary[0]);

// Set up the SVG dimensions

var ordTrendElement_info = document.getElementById({elementID: 'orderedTrends_div'});
var ordTrend_positionInfo = ordTrendElement_info.getBoundingClientRect();

console.log("We got here bro");

// Set up the SVG dimensions
var width = ordTrend_positionInfo.width;
var height = ordTrend_positionInfo.height;
  
console.log('Show me the money:' + width);

// Set up the margins
var margin = { top: height*0.05,
                 bottom: height*0.1,
                 right: width*0.05,  
                 left: width*0.15 };

// Calculate the inner dimensions of the plot
var innerWidth = width - margin.left - margin.right;
var innerHeight = height - margin.top - margin.bottom;

// Create the SVG container
var svg = d3.select("#orderedTrends")
  .append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");



// Set up the scales
var xScale = d3.scaleBand()
  .domain(d3.range(trendSummary.length))
  .range([margin.left, innerWidth])
  .padding(0.1);

var yScale = d3.scaleLinear()
  .domain([d3.min(trendSummary.map(d => d.LCItrend)), d3.max(trendSummary.map(d => d.LCItrend))])
  .range([innerHeight, margin.top]);

  // Create the circle that travels along the curve of chart
  var focus = svg
  .append('g')
  .append('circle')
    .style("fill", "none")
    .attr("stroke", "black")
    .attr('r', 8.5)
    .style("opacity", 0)

// Create the text that travels along the curve of chart
var focusText = svg
  .append('g')
  .append('text')
    .style("opacity", 0)
    .style("font-size", "20px")
    .style("white-space","pre-line")
    .attr("text-anchor", "left")
    .attr("alignment-baseline", "middle")

var focusDrop = svg
      .append('line')
      .attr("x1", xScale(0))
      .attr("x2", xScale(0))
      .attr("y1", yScale(0))
      .attr("y2", yScale(0))
      .attr("stroke",'gray')
      .style("opacity",0)
// Plot the segments
svg.selectAll("line")
  .data(trendSummary)
  .enter().append("line")
  .attr("x1", (d, i) => xScale(i))
  .attr("x2", (d, i) => xScale(i))
  .attr("y1", d => yScale(d.LCItrend))
  .attr("y2", d => yScale(d.UCItrend))
  .attr("stroke", "gray");

  // Plot the points
svg.selectAll("circle")
.data(trendSummary)
.enter().append("circle")
.attr("cx", (d, i) => xScale(i))
.attr("cy", d => yScale(d.trend))
.attr("r", 6)
.attr("fill", d => d.trend < 0 ? "red" : "blue")
.attr("fill", d => d.StatSig ? 0 : "gray")
.attr("stroke", d => d.StatSig ? "black" : "white")
.on('mouseover', mouseover)
.on('mousemove', mousemove)
.on('mouseout', mouseout);

// What happens when the mouse move -> show the annotations at the right positions.
function mouseover() {
    focus.style("opacity", 1)
    focusText.style("opacity",1).style("font-size","18px").style("white-space","pre-line")
    focusDrop.style("opacity",0.75)
  }

  function mousemove() {
    // recover coordinate we need
    var x0 = yScale.invert(d3.mouse(this)[1]);
    var i = d3.bisectRight(d => d.trend,x0);

    console.log(i)
    var selectedData = trendSummary[i]

    focus
      .attr("cx", xScale(x0))
      .attr("cy", yScale(selectedData.trend))
    focusText
      .html(selectedData.species)
      .style("font-size","18px")
      .attr("x", xScale(x0))
      .attr("y", yScale(selectedData.trend))
    focusDrop
      .attr("x1", xScale(0))
      .attr("x2", xScale(0))
      .attr("y1", yScale(0))
      .attr("y2", yScale(0))

    }
  function mouseout() {
    focus.style("opacity", 0)
    focusText.style("opacity", 0)
    focusDrop.style("opacity",0)
  }


// Draw the horizontal dashed line
svg.append("line")
  .attr("x1", 0)
  .attr("x2", width)
  .attr("y1", yScale(0))
  .attr("y2", yScale(0))
  .attr("stroke", "gray")
  .attr("stroke-dasharray", "4");

// Draw y-axis
svg.append('g')
    .attr('transform', `translate(${margin.left-10})`)
    .call(d3.axisLeft(yScale));

svg.append("text")
.attr("class", "y label")
.attr("text-anchor", "middle")
// this is a little weird because it's rotated 90 degrees
// the x here is actually where on the y axis that I want it
// The y axis here is actually where I want it on the x axis
.attr("y", -26)
.attr("x", -200-((margin.right+margin.left)))
.attr("transform", "rotate(-90)")
.text('Trend');

/*var imgs = svg
            .append("svg:image")
            .attr("xlink:href", "https://vtecostudies.org/wp-content/uploads/2014/08/eastern-wood-pewee.jpg")
                .attr("x", width - 200)
                .attr("y", 200)
                .attr("width", "200")
                .attr("height", "425");*/